{% extends 'base.html' %}
{% block content %}
<style type="text/css" media="screen">
#cloud-plugins-library .filter {
  left: none;
  right: none;
  width: calc(350px - 20px);
  margin: 0 10px;
}
.cloud-plugins {
  left: 350px;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
$('document').ready(function() {
    // var ws = new WebSocket('ws://192.168.51.1/rpbsocket');
    // ws.onopen = function() {
    //     ws.onmessage = function (evt) {
    //         console.log(evt)
    //         ws.close();
    //     }
    // 
    //     ws.send('hello')
    // }
    // ws.onerror = function (err) {
    //     console.log(err)
    // }

    var socket = io('ws://' + window.location.host + '/');
    socket.on('connect', function() {
        socket.emit('my event', {
            name: 'My Cool Plugin',
            brand: 'My Cool Brand',
            category: 'Delay',
        });
    });
    socket.on('status', function(status) {
        console.log('got new status:', status)
    });
    socket.on('buildlog', function(msg) {
        console.log('got buildlog:', msg)
    });
    socket.on('buildfile', function(data) {
        // window.plugindata = data;
        var formdata = new FormData();
        formdata.append('package', new File([data], '-'));
        fetch('http://192.168.51.1/sdk/install', {
            method: 'POST',
            // mode: 'cors',
            body: formdata
        }).then((response) => {
            console.log('build push okay!', response)
            return response.json();
        }).then((response) => {
            console.log(response);
        }).catch((error) => {
            console.log('build push error', error)
        });
    });
    socket.on('response', function(msg) {
        console.log(msg)
    });

    // $('#log').append('<div class="mb-1 text-white">âœ“ ' + msg.data + '</div>');
    // $('#log').parent().animate({scrollTop: $('#log')[0].scrollHeight}, 200);
})
</script>
<div id="cloud-plugins-library">
    <div class="box clearfix">
        <header>
            <h1 class="bottom top">FAUST PLUGIN BUIDER</h1>
        </header>
        <div id="cloudplugin-results-wrapper">
            <div class="filter clearfix">
                <h2>Plugin settings</h2>
                <div>
                    <div class="form-group">
                        <label for="files" class="form-label">Plugin files</label>
                        <input type="file" class="form-control" name="files[]" id="files" accept=".h,.cpp,.json,.dsp" multiple required>
                    </div>
                    <div class="form-group">
                        <label for="name" class="form-label">Plugin name</label>
                        <input type="text" class="form-control" name="name" value="{{ name }}" id="name" placeholder="Plugin name" required>
                    </div>
                    <div class="form-group">
                        <label for="brand" class="form-label">Plugin brand</label>
                        <input type="text" class="form-control" name="brand" value="{{ brand }}" id="brand" placeholder="Plugin brand">
                    </div>
                    <div class="form-group">
                        <label for="category" class="form-label">Plugin category</label>
                        <select name="category" class="form-control" id="category">
                            {% for category in categories %}
                            <option value="{{ category }}">
                                {{ category }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="uri" class="form-label">Plugin URI</label>
                        <input type="text" class="form-control" name="uri" value="{{ uri }}" id="uri" placeholder="Plugin URI" required>
                    </div>
                    <div class="mb-3 form-group form-check">
                        <input class="form-check-input" type="checkbox" value="" id="save-settings">
                        <label class="form-check-label" for="save-settings">
                            Save settings as default
                        </label>
                    </div>
                    <input type="submit" class="btn btn-primary" value="Build">
                </div>
            </div>
            <div class="cloud-plugins clearfix js-cloud-plugins">
                <div id="cloudplugin-results-wrapper">
                    <h2>Drag &amp; drop a faust *.dsp file here to begin</h2>
                    <div id="cloud-plugin-content-All" class="plugins-wrapper"></div>
              </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
